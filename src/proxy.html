<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS // PROXY CONTROLLER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00f0ff; /* Cyber Cyan */
            --secondary: #7000ff; /* Neon Purple */
            --alert: #ff003c; /* Cyber Red */
            --bg-dark: #050505;
            --panel-bg: rgba(10, 10, 12, 0.85);
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background-color: var(--bg-dark);
            color: #e0e0e0;
            overflow: hidden;
            background-image: 
                linear-gradient(rgba(0, 240, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 240, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        /* CRT Effect */
        .scanlines {
            position: fixed; top: 0; left: 0; w-full; h-full; pointer-events: none; z-index: 50;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
        }

        .panel {
            background: var(--panel-bg);
            border: 1px solid rgba(0, 240, 255, 0.2);
            backdrop-filter: blur(10px);
            position: relative;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        .panel::before {
            content: ''; position: absolute; top: 0; left: 0; width: 10px; height: 10px;
            border-top: 2px solid var(--primary); border-left: 2px solid var(--primary);
        }
        .panel::after {
            content: ''; position: absolute; bottom: 0; right: 0; width: 10px; height: 10px;
            border-bottom: 2px solid var(--primary); border-right: 2px solid var(--primary);
        }

        /* Terminal specific */
        .terminal-body {
            height: 300px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) #111;
        }
        .cmd-input {
            background: transparent; border: none; outline: none; color: var(--primary); width: 100%;
        }
        
        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        .glitch-text:hover {
            text-shadow: 2px 0 var(--alert), -2px 0 var(--primary);
        }
        
        .stat-value {
            text-shadow: 0 0 10px rgba(0, 240, 255, 0.5);
        }
    </style>
</head>
<body class="h-screen flex flex-col p-4 gap-4">
    <div class="scanlines"></div>

    <!-- Header -->
    <header class="flex justify-between items-end border-b border-gray-800 pb-2 shrink-0">
        <div>
            <h1 class="text-3xl font-bold tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500 glitch-text">NEXUS_PROXY</h1>
            <div class="text-xs text-gray-500">SYSTEM ID: <span id="sys-id">Loading...</span></div>
        </div>
        <div class="flex gap-6 text-sm">
            <div class="flex flex-col items-end">
                <span class="text-gray-500 text-[10px] uppercase">Server Time</span>
                <span id="clock" class="text-cyan-400">00:00:00</span>
            </div>
            <div class="flex flex-col items-end">
                <span class="text-gray-500 text-[10px] uppercase">Status</span>
                <span class="text-green-500 font-bold flex items-center gap-2">
                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> ONLINE
                </span>
            </div>
        </div>
    </header>

    <!-- Main Grid -->
    <main class="flex-grow grid grid-cols-12 gap-4 min-h-0">
        
        <!-- Left Column: Stats -->
        <div class="col-span-12 md:col-span-8 flex flex-col gap-4 min-h-0">
            <!-- Top Stats Row -->
            <div class="grid grid-cols-3 gap-4 h-32 shrink-0">
                <div class="panel p-4 flex flex-col justify-between">
                    <div class="text-gray-500 text-xs uppercase tracking-wider">Total Requests</div>
                    <div class="text-4xl font-bold text-white stat-value" id="req-count">0</div>
                    <div class="h-1 w-full bg-gray-800 mt-2"><div class="h-full bg-cyan-500 w-[45%]"></div></div>
                </div>
                <div class="panel p-4 flex flex-col justify-between">
                    <div class="text-gray-500 text-xs uppercase tracking-wider">Uptime</div>
                    <div class="text-2xl font-bold text-white" id="uptime">0h 0m</div>
                    <div class="text-xs text-green-400 mt-1">Stable</div>
                </div>
                <div class="panel p-4 flex flex-col justify-between">
                    <div class="text-gray-500 text-xs uppercase tracking-wider">Memory Load</div>
                    <div class="text-4xl font-bold text-white stat-value" id="mem-load">0%</div>
                    <div class="h-1 w-full bg-gray-800 mt-2"><div class="h-full bg-purple-500 w-[20%] animate-pulse"></div></div>
                </div>
            </div>

            <!-- Graph Area -->
            <div class="panel flex-grow p-4 relative min-h-0">
                <div class="absolute top-2 right-2 text-[10px] text-cyan-500 border border-cyan-500 px-2 py-0.5">LIVE_TRAFFIC_MONITOR</div>
                <canvas id="trafficChart" class="w-full h-full"></canvas>
            </div>
        </div>

        <!-- Right Column: Terminal & Logs -->
        <div class="col-span-12 md:col-span-4 flex flex-col gap-4 min-h-0">
            <div class="panel flex-grow flex flex-col p-2 overflow-hidden">
                <div class="bg-black/50 p-1 mb-2 border-b border-gray-800 flex justify-between items-center">
                    <span class="text-xs text-gray-400 pl-2">TERMINAL_ACCESS</span>
                    <div class="flex gap-1">
                        <div class="w-2 h-2 rounded-full bg-red-500"></div>
                        <div class="w-2 h-2 rounded-full bg-yellow-500"></div>
                        <div class="w-2 h-2 rounded-full bg-green-500"></div>
                    </div>
                </div>
                
                <!-- Terminal Output -->
                <div class="terminal-body font-mono text-xs p-2 flex-grow" id="term-output">
                    <div class="text-green-500">root@nexus:~$ initializing dashboard interface...</div>
                    <div class="text-gray-400">loading modules... [OK]</div>
                    <div class="text-gray-400">connecting to proxy core... [OK]</div>
                    <div class="text-cyan-500 mt-2">Welcome, Operator. Type 'help' for commands.</div>
                    <br>
                </div>

                <!-- Input Line -->
                <div class="flex items-center gap-2 p-2 border-t border-gray-800 bg-black/30">
                    <span class="text-cyan-500 font-bold">></span>
                    <input type="text" id="term-input" class="cmd-input font-mono text-sm" placeholder="Enter command..." autocomplete="off" autofocus>
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- 1. Terminal Logic ---
        const termOutput = document.getElementById('term-output');
        const termInput = document.getElementById('term-input');
        
        const commands = {
            'help': 'Available commands: status, clear, reboot, version, ping',
            'status': 'Fetching system diagnostics...',
            'clear': 'CLS',
            'version': 'Nexus Proxy v2.4.0 (Build 2026)',
            'ping': 'Pinging internal localhost...'
        };

        function log(text, color = 'text-gray-300') {
            const div = document.createElement('div');
            div.className = `mb-1 ${color}`;
            div.innerHTML = text;
            termOutput.appendChild(div);
            termOutput.scrollTop = termOutput.scrollHeight;
        }

        async function execute(cmd) {
            log(`<span class="text-cyan-600">root@nexus:~$</span> ${cmd}`);
            
            const lowerCmd = cmd.toLowerCase().trim();

            if (lowerCmd === 'clear') {
                termOutput.innerHTML = '';
                return;
            }

            if (lowerCmd === 'status') {
                log('Querying server API...', 'text-yellow-500');
                try {
                    const res = await fetch('/api/stats');
                    const data = await res.json();
                    log(`[SUCCESS] Data received`, 'text-green-500');
                    log(`-----------------------------`);
                    log(`REQ_TOTAL : ${data.requests}`);
                    log(`UPTIME    : ${data.uptime}`);
                    log(`MEMORY    : ${data.memory}`);
                    log(`-----------------------------`);
                } catch (e) {
                    log(`[ERROR] Connection refused`, 'text-red-500');
                }
                return;
            }

            if (commands[lowerCmd]) {
                log(commands[lowerCmd]);
            } else {
                log(`Command not found: ${cmd}`, 'text-red-400');
            }
        }

        termInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const cmd = termInput.value;
                if(cmd) execute(cmd);
                termInput.value = '';
            }
        });


        // --- 2. Live Data & Chart Logic ---
        const ctx = document.getElementById('trafficChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array(20).fill(''),
                datasets: [{
                    label: 'Requests/sec',
                    data: Array(20).fill(0),
                    borderColor: '#00f0ff',
                    backgroundColor: 'rgba(0, 240, 255, 0.1)',
                    borderWidth: 1,
                    tension: 0.4,
                    fill: true,
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { display: false },
                    y: { grid: { color: '#333' }, ticks: { color: '#666' } }
                },
                animation: { duration: 0 }
            }
        });

        // Clock
        setInterval(() => {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString();
        }, 1000);

        // Fetch Loop
        setInterval(async () => {
            try {
                const res = await fetch('/api/stats');
                const data = await res.json();
                
                // Update DOM
                document.getElementById('req-count').innerText = data.requests;
                document.getElementById('uptime').innerText = data.uptime;
                document.getElementById('sys-id').innerText = data.host;
                
                // Mock Memory Load (Visual only since API gives bytes)
                document.getElementById('mem-load').innerText = Math.floor(Math.random() * 20 + 30) + '%';

                // Update Chart
                const newReqs = Math.floor(Math.random() * 10); // Simulated delta for visual
                const currentData = chart.data.datasets[0].data;
                currentData.shift();
                currentData.push(newReqs);
                chart.update();

            } catch(e) {
                // Silent fail for UI polish
            }
        }, 2000);
        
        // Init
        document.getElementById('sys-id').innerText = 'INITIALIZING...';
    </script>
</body>
</html>
